<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Early Learning Family Portal: User Profile</title>
  <!-- Only use the consolidated profile stylesheet (local) -->
  <link rel="stylesheet" href="../public/css/profile.css">
</head>

<body>
  <header class="site-header">
    <div class="header-bar">
      <div class="brand">
  <img class="brand__logo" src="../public/images/logoNew.png" alt="Florida Early Learning Logo" />
        <span class="brand__env">DEV Family Portal- User Profile</span>
      </div>
      <nav>
        <ul class="nav-actions" id="nav-actions">
          <li><a class="btn btn-outline" href="signin.html" aria-label="Sign in">Sign In</a></li>
          <li><a class="btn btn-inverse" href="signup.html" aria-label="Sign up">Sign Up</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Profile welcome: populated when authenticated -->
  <div id="profile-welcome" class="profile-welcome">
    <div class="container">
      <div class="welcome-text">Welcome back,</div>
      <div id="profile-user" class="welcome-user"></div>
    </div>
  </div>

  <main>
    <section class="section--summary">
      <div class="container">
        <div class="summary-head">
          <div>
            <h2 class="summary-title">Household at a Glance</h2>
            <p class="muted">Quick summary of your household, active applications and important alerts.</p>
          </div>
          <div class="summary-actions">
            <a class="btn btn-outline" href="profile.html">Refresh</a>
            <a class="btn btn-inverse" href="signin.html">Manage account</a>
          </div>
        </div>

        <!-- Household summary row -->
        <div class="summary-row">
          <div class="summary-card">
            <h3 class="card-h3-blue">Household at a Glance</h3>
            <p class="muted">Members: <strong id="hh-members">—</strong></p>
            <p class="muted">Active applications: <strong id="hh-active">—</strong></p>
            <a class="btn btn-outline" href="profile.html">View details</a>
          </div>

          <div class="summary-card">
            <h3 class="card-h3-green">VPK Applications</h3>
            <p class="muted">Start or continue your VPK application.</p>
            <a class="btn btn-green" href="signin.html">Apply / View</a>
          </div>

          <div class="summary-card">
            <h3 class="card-h3-red">School Readiness Applications</h3>
            <p class="muted">Apply for School Readiness assistance or check status.</p>
            <a class="btn btn-blue" href="srapp.html">Apply / View</a>
          </div>
        </div>
      </div>
    </section>

    <section class="section--content">
      <div class="container two-col-grid">
        <!-- Left: Detailed panels -->
        <div>
          <div class="panel">
            <h3 class="card-title card-h3-blue">Household at a Glance</h3>
            <p class="muted">This section shows household members, contact information and a summary of recent activity.</p>
            <ul id="hh-list" class="ul-muted">
              <li>Loading household members…</li>
            </ul>
          </div>

          <div class="panel">
            <h3 class="card-title card-h3-green">VPK Applications</h3>
            <p class="muted">Your VPK applications and their status.</p>
            <div id="vpk-list" class="ul-muted">No VPK applications found.</div>
          </div>
        </div>

        <!-- Right: Quick actions / SR apps -->
        <aside>
          <div class="panel">
            <h3 class="card-title card-h3-red">School Readiness Applications</h3>
            <p class="muted">Quick access to School Readiness applications and status checks.</p>
            <div id="sr-list" class="ul-muted">No School Readiness applications found.</div>
          </div>

          <div class="panel">
            <h4 class="quicklinks-title">Quick Links</h4>
            <ul style="padding-left:18px;margin:0;color:var(--muted)">
              <li><a href="signin.html">Manage account</a></li>
              <li><a href="signin.html">Start new application</a></li>
            </ul>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p>
      Please contact your <a href="https://www.floridaearlylearning.com/parents/find_quality_child_care/locate_a_child_care_resource_referral_program/countys_early_learning_coalition.aspx" target="_blank">early learning coalition</a> for immediate assistance.
    </p>
    <p>This site is best viewed with Microsoft Edge. Download <a href="https://www.microsoft.com/en-us/edge" target="_blank">Microsoft Edge</a>.</p>
    <p>If you are using an Apple device, please use <a href="https://itunes.apple.com/us/app/chrome-web-browser-by-google/id535886823?mt=8" target="_blank">Google Chrome</a> to complete your application.</p>
  </footer>
</body>
  <script>
    (function(){
      async function isAuthenticated(){
        try{
          const r = await fetch('/.auth/me',{credentials:'include'});
          if(!r.ok) return false;
          const j = await r.json();
          return Array.isArray(j) && j.length>0 ? j[0] : false;
        }catch(e){return false}
      }
      function clearClientStorage(){
        try{localStorage.clear();sessionStorage.clear();}catch(e){}
        document.cookie.split(';').forEach(function(c){var name=c.split('=')[0].trim();if(!name) return;document.cookie = name+'=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';});
      }
      function signOut(){
        clearClientStorage();
        // Use Easy Auth logout which will clear server cookies and redirect back to index
        window.location.href = '/.auth/logout?post_logout_redirect_uri=/index.html';
      }
      document.addEventListener('DOMContentLoaded', async function(){
        var nav = document.getElementById('nav-actions'); if(!nav) return;
        var user = await isAuthenticated();
          if(!user){
            // Not authenticated: redirect to sign-in flow (show sign-in page)
            window.location.href = '/signin.html';
            return;
          }

          // Authenticated: show sign out and populate welcome
          nav.innerHTML = '<li><button id="signout" class="btn btn-outline">Sign Out</button></li>';
          document.getElementById('signout').addEventListener('click', signOut);

          // Populate welcome area with an available claim (email or name)
          try{
            var display = user.user_claims && user.user_claims.length ? (user.user_claims.find(c=>/email|upn|name/i.test(c.typ))||{}).val : (user.name || user.user_id || '');
            if(!display && user.claims && user.claims.length) display = (user.claims.find(c=>/email|upn|name/i.test(c.typ))||{}).val || user.user_id || '';
            if(display){
              var el = document.getElementById('profile-user'); if(el){ el.textContent = display; document.getElementById('profile-welcome').style.display = 'block'; }
            }
          }catch(e){console.warn('Unable to populate profile user', e);} 
      });
    })();
  </script>
</html>
